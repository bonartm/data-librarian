<!doctype html><html lang=en class="js csstransforms3d"><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=generator content="Hugo 0.62.2"><meta name=description content="learning materials for the data librarian course"><meta name=author content="Malte Bonart and Konrad Förstner"><link rel=icon href=/data-librarian/images/favicon.png type=image/png><title>Exkurs: Fehlende Werte :: data librarian - modul 3 - daten analysieren und darstellen</title><link href=/data-librarian/css/nucleus.css?1580061250 rel=stylesheet><link href=/data-librarian/css/fontawesome-all.min.css?1580061250 rel=stylesheet><link href=/data-librarian/css/hybrid.css?1580061250 rel=stylesheet><link href=/data-librarian/css/featherlight.min.css?1580061250 rel=stylesheet><link href=/data-librarian/css/perfect-scrollbar.min.css?1580061250 rel=stylesheet><link href=/data-librarian/css/auto-complete.css?1580061250 rel=stylesheet><link href=/data-librarian/css/atom-one-dark-reasonable.css?1580061250 rel=stylesheet><link href=/data-librarian/css/theme.css?1580061250 rel=stylesheet><link href=/data-librarian/css/hugo-theme.css?1580061250 rel=stylesheet><link href=/data-librarian/css/theme-green.css?1580061250 rel=stylesheet><link href=/data-librarian/css/custom.css?1580061250 rel=stylesheet><script src=/data-librarian/js/jquery-3.3.1.min.js?1580061250></script><style>:root #header+#content>#left>#rlblock_left{display:none!important}</style></head><body data-url=/data-librarian/basics/pandas/na/><nav id=sidebar class=showVisitedLinks><div id=header-wrapper><div id=header><a id=logo href=https://bonartm.github.io/data-librarian/><h4 style=font-size:2.5rem;overflow-wrap:anywhere>Data Librarian</h3><h6 style=font-size:1rem;overflow-wrap:anywhere>Modul 3: Data analysieren und darstellen</h3></a></div><div class=searchbox><label for=search-by><i class="fas fa-search"></i></label><input data-search-input id=search-by type=search placeholder=Search...>
<span data-search-clear><i class="fas fa-times"></i></span></div><script type=text/javascript src=/data-librarian/js/lunr.min.js?1580061250></script><script type=text/javascript src=/data-librarian/js/auto-complete.js?1580061250></script><script type=text/javascript>var baseurl="https:\/\/bonartm.github.io\/data-librarian\/";</script><script type=text/javascript src=/data-librarian/js/search.js?1580061250></script></div><div class=highlightable><ul class=topics><li data-nav-id=/data-librarian/organisation/ title="Kursorganisation und Vorbereitungen" class=dd-item><a href=/data-librarian/organisation/><b>1. </b>Kursorganisation und Vorbereitungen
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/data-librarian/organisation/modules/ title=Kurseinheiten class=dd-item><a href=/data-librarian/organisation/modules/>Kurseinheiten
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/schedule/ title=Termine class=dd-item><a href=/data-librarian/organisation/schedule/>Termine
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/anaconda/ title="Conda und Anaconda" class=dd-item><a href=/data-librarian/organisation/anaconda/>Conda und Anaconda
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/notebooks/ title="Jupyter Notebooks" class=dd-item><a href=/data-librarian/organisation/notebooks/>Jupyter Notebooks
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/dataset/ title="San Francisco Library Usage" class=dd-item><a href=/data-librarian/organisation/dataset/>San Francisco Library Usage
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/ title="Python Pakete und Bibliothekten" class=dd-item><a href=/data-librarian/organisation/packages/>Python Pakete und Bibliothekten
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/data-librarian/organisation/packages/numpy/ title=numpy class=dd-item><a href=/data-librarian/organisation/packages/numpy/>numpy
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/pandas/ title=pandas class=dd-item><a href=/data-librarian/organisation/packages/pandas/>pandas
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/matplotlib/ title=matplotlib class=dd-item><a href=/data-librarian/organisation/packages/matplotlib/>matplotlib
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/seaborn/ title=seaborn class=dd-item><a href=/data-librarian/organisation/packages/seaborn/>seaborn
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/scipy/ title=scipy class=dd-item><a href=/data-librarian/organisation/packages/scipy/>scipy
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/organisation/packages/scikitlearn/ title=scitkit-learn class=dd-item><a href=/data-librarian/organisation/packages/scikitlearn/>scitkit-learn
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/data-librarian/organisation/quiz_intro/ title="Recap: Quiz" class=dd-item><a href=/data-librarian/organisation/quiz_intro/>Recap: Quiz
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/data-librarian/basics/ title=Grundlagen class="dd-item
parent"><a href=/data-librarian/basics/><b>2. </b>Grundlagen
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/data-librarian/basics/ml/ title="Statistik, Data Science und Machine Learning" class=dd-item><a href=/data-librarian/basics/ml/>Statistik, Data Science und Machine Learning
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/data-librarian/basics/ml/statistic/ title=Statistik class=dd-item><a href=/data-librarian/basics/ml/statistic/>Statistik
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/ml/ml/ title="Machine Learning" class=dd-item><a href=/data-librarian/basics/ml/ml/>Machine Learning
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/ml/data-science/ title="Data Science" class=dd-item><a href=/data-librarian/basics/ml/data-science/>Data Science
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/data-librarian/basics/basic_terms/ title="Grundbegriffe der Statistik" class=dd-item><a href=/data-librarian/basics/basic_terms/>Grundbegriffe der Statistik
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/ title="Praktische Einführung in Pandas" class="dd-item
parent"><a href=/data-librarian/basics/pandas/>Praktische Einführung in Pandas
<i class="fas fa-check read-icon"></i></a><ul><li data-nav-id=/data-librarian/basics/pandas/series/ title="Series und DataFrames" class=dd-item><a href=/data-librarian/basics/pandas/series/>Series und DataFrames
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/io/ title="Ein- und Ausgabe" class=dd-item><a href=/data-librarian/basics/pandas/io/>Ein- und Ausgabe
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/columns/ title="Auswahl und Erstellung von Spalten" class=dd-item><a href=/data-librarian/basics/pandas/columns/>Auswahl und Erstellung von Spalten
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/rows/ title="Auswahl von Zeilen" class=dd-item><a href=/data-librarian/basics/pandas/rows/>Auswahl von Zeilen
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/na/ title="Exkurs: Fehlende Werte" class="dd-item active"><a href=/data-librarian/basics/pandas/na/>Exkurs: Fehlende Werte
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/pandas/functions/ title="Nützliche Funktionen in Pandas" class=dd-item><a href=/data-librarian/basics/pandas/functions/>Nützliche Funktionen in Pandas
<i class="fas fa-check read-icon"></i></a></li></ul></li><li data-nav-id=/data-librarian/basics/reflection/ title="Reflexion: Datenprojekte an Ihrer Arbeitsstelle" class=dd-item><a href=/data-librarian/basics/reflection/>Reflexion: Datenprojekte an Ihrer Arbeitsstelle
<i class="fas fa-check read-icon"></i></a></li><li data-nav-id=/data-librarian/basics/quiz_pandas/ title="Recap: Quiz" class=dd-item><a href=/data-librarian/basics/quiz_pandas/>Recap: Quiz
<i class="fas fa-check read-icon"></i></a></li></ul></li></ul><section id=shortcuts><h3>More</h3><ul><li><a class=padding href=https://bonartm.github.io/data-librarian/solutions/><i class="fas fa-cookie-bite"></i>Lösungen zu den Kursaufgaben</a></li><li><a class=padding href=https://bonartm.github.io/data-librarian/organisation/schedule/><i class="far fa-calendar-check"></i>Termine und Überblick</a></li><li><a class=padding href="https://zbiw.th-koeln.de/moodle/course/view.php?id=300"><i class="fas fa-users"></i>Moodle Kursumgebung</a></li></ul></section><section id=prefooter><hr><ul><li><a class=padding href=# data-clear-history-toggle><i class="fas fa-history fa-fw"></i>Clear History</a></li></ul></section><section id=footer><p><a rel=license href=http://creativecommons.org/licenses/by/4.0/><img alt="Creative Commons License" style=border-width:0 src=https://i.creativecommons.org/l/by/4.0/80x15.png></a><br>This work is licensed under a <a rel=license href=http://creativecommons.org/licenses/by-sa/4.0/>Creative Commons Attribution 4.0 International License</a>. Author: <a href="mailto:malte@bonart.de?Subject=Data Librarian" target=_top>Malte Bonart</a> and <a href="mailto:foerstner@zbmed.de?Subject=Data Librarian" target=_top>Konrad Förstner</a>.</p></section></div></nav><section id=body><div id=overlay></div><div class="padding highlightable"><div><div id=top-bar><div id=breadcrumbs itemscope itemtype=http://data-vocabulary.org/Breadcrumb><span id=sidebar-toggle-span><a href=# id=sidebar-toggle data-sidebar-toggle><i class="fas fa-bars"></i></a></span><span class=links><a href=/data-librarian/>Modul 3</a> > <a href=/data-librarian/basics/>Grundlagen</a> > <a href=/data-librarian/basics/pandas/>Praktische Einführung in Pandas</a> > Exkurs: Fehlende Werte</span></div></div></div><div id=head-tags></div><div id=body-inner><h1>Exkurs: Fehlende Werte</h1><p>Real erhobene Daten sind meistens unsauber und fehlerhaft. Ein häufiges Problem dabei sind <strong>fehlende Werte</strong>, also Beobachtungen für die manche Merkmale nicht erhoben wurden. In jedem Datensatz werden fehlende Werte anders gekennzeichnet, aber man findet oft diese Kodierungen wieder: <code>"-999", "NA", " ", "None", "NULL", "#N/A"</code>.</p><p>Wenn beispielsweise der Mittelwert einer statistischen Variable berechnet wird, so muss entschieden werden, wie mit fehlenden Werten umgegangen werden soll: Sollen die Werte <strong>entfernt</strong> werden? Sollen die fehlenden Werte durch einen bestimmten Wert <strong>ersetzt</strong> werden?</p><p>In <code>DataFrame</code>s werden fehlende Werte durch das Schlüsselwort <code>NaN</code> ("<strong>Not a Number</strong>") angezeigt. Beim Einlesen von Daten (siehe z.B. die <a href=https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.read_csv.html><code>read_csv</code> Funktion</a>) können mit dem Argument <code>na_values</code> zusätzliche Kodierungen für fehlerhafte Werte mit angegeben werden.</p><h3 id=fallbeispiel>Fallbeispiel</h3><p>Der Library Usage Datensatz enthält die Kodierung <code>"None"</code> für fehlende Werte. Diese werden von <code>pandas</code> beim Einlesen von numerischen Spalten nicht richtig erkannt:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#f92672>import</span> pandas <span style=color:#f92672>as</span> pd

df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>../data/Library_Usage.csv</span><span style=color:#e6db74>&#34;</span>)
df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Circulation Active Year</span><span style=color:#e6db74>&#39;</span>]
</code></pre></div><p>Obwohl die Spalte <code>'Circulation Active Year'</code> numerisch ist, wird Sie von <code>pandas</code> als Text abgespeichert, da <code>"None"</code> nicht als Zahl erkannt wird. Möchten Sie z.B. <code>2019 - df['Circulation Active Year']</code> berechnen, so werden Sie eine Fehlermeldung erhalten, da für Text-Werte keine Substraktionen durchgeführt werden können.</p><p>Um das Problem zu beheben können Sie auf zwei Arten vorgehen. Sie können schon beim Einlesen, die Kodierung für fehlende Werte mit angeben:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>../data/Library_Usage.csv</span><span style=color:#e6db74>&#34;</span>, na_values<span style=color:#f92672>=</span><span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>None</span><span style=color:#e6db74>&#34;</span>)
df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Circulation Active Year</span><span style=color:#e6db74>&#39;</span>]
</code></pre></div><p>Oder Sie führen nach dem Einlesen eine <strong>explizite Umwandlung</strong> des Datentyps durch:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>read_csv(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>../data/Library_Usage.csv</span><span style=color:#e6db74>&#34;</span>, na_values<span style=color:#f92672>=</span><span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>None</span><span style=color:#e6db74>&#34;</span>)
df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Circulation Active Year</span><span style=color:#e6db74>&#39;</span>] <span style=color:#f92672>=</span> pd<span style=color:#f92672>.</span>to_numeric(df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Circulation Active Year</span><span style=color:#e6db74>&#39;</span>], errors<span style=color:#f92672>=</span><span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>coerce</span><span style=color:#e6db74>&#39;</span>)
df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Circulation Active Year</span><span style=color:#e6db74>&#39;</span>]
</code></pre></div><div class=customnotices><div class=notices_inner id=exercise><h4 id=datentypen-1-minute>Datentypen (1 Minute)</h4><p>Was unterscheidet den Wert <code>None</code> vom Wert <code>"None"</code>? Was den Wert <code>5</code> vom Wert <code>"5"</code>? Was den Wert <code>"NaN"</code> vom Wert <code>NaN</code>? Ist <code>True</code> und <code>"True"</code> das gleiche?</p></div></div><h3 id=behandlung-von-fehlenden-werten>Behandlung von Fehlenden Werten</h3><p><code>Pandas</code> bietet für <code>Series</code> und <code>DataFrame</code>s die nützlichen Funktionen <code>isna()</code>, <code>notna()</code>, <code>dropna()</code> und <code>fillna()</code> an um fehlende Werte zu identifizieren, zu entfernen oder mit anderen Werten zu ersetzen.</p><h4 id=filter>Filter</h4><p>Die Funktionen <code>isna</code> (<code>notna</code>) geben eine boolesche <code>Series</code> zurück, die <code>True</code> (<code>False</code>) ist, wenn an der Stelle ein fehlender Wert steht. Damit pandas fehlende Werte korrekt erkennt, müssen diese vorher erst in das interne Format <code>NaN</code> umgewandelt werden (siehe oben).</p><div class=customnotices><div class=notices_inner id=code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df[df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Age Range</span><span style=color:#e6db74>&#39;</span>]<span style=color:#f92672>.</span>isna()]
df[df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Age Range</span><span style=color:#e6db74>&#39;</span>]<span style=color:#f92672>.</span>notna()]
</code></pre></div></div></div><p>Mit diesem nützlichen Befehl können Sie sich schnell die Anzahl fehlender Werte in jeder Spalte ausgeben lassen:</p><div class=customnotices><div class=notices_inner id=code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df<span style=color:#f92672>.</span>isna()<span style=color:#f92672>.</span>sum()
</code></pre></div></div></div><p>Dies funktioniert, da Python bei Bedarf einen booleschen Wert implizit in ein numerisches Format konvertiert. <code>True</code> wird zu 1 konvertiert und <code>False</code> zu 0.</p><h4 id=entfernen>Entfernen</h4><div class=customnotices><div class=notices_inner id=code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#75715e># drops all rows that contain at least one missing values</span>
df<span style=color:#f92672>.</span>dropna()
<span style=color:#75715e># drops all missing values in this series</span>
df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Age Range</span><span style=color:#e6db74>&#39;</span>]<span style=color:#f92672>.</span>dropna()
</code></pre></div></div></div><h4 id=ersetzen>Ersetzen</h4><div class=customnotices><div class=notices_inner id=code><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>df[<span style=color:#e6db74></span><span style=color:#e6db74>&#39;</span><span style=color:#e6db74>Age Range</span><span style=color:#e6db74>&#39;</span>]<span style=color:#f92672>.</span>fillna(<span style=color:#e6db74></span><span style=color:#e6db74>&#34;</span><span style=color:#e6db74>keine Angabe</span><span style=color:#e6db74>&#34;</span>)
</code></pre></div></div></div><div class=customnotices><div class=notices_inner id=tip><p>Standardmäßig werden bei den Operationen <code>fillna</code> oder <code>dropna</code> neue <code>Series</code> oder <code>DataFrame</code>s zurückgegeben. Die originale Variable bleibt dabei unangetastet. Mit dem Argument <code>inplace=True</code> werden die originalen Objekte direkt überschrieben.</p></div></div><div class=customnotices><div class=notices_inner id=exercise><h4 id=exkurs-fehlende-werte-20-min>Exkurs: Fehlende Werte (20 Min)</h4><ul><li>Welche Spalten enthalten alles fehlende Werte?</li><li>Lesen Sie den Datensatz ein und erstellen Sie einen <code>DataFrame</code> der keine Beobachtungen mit fehlenden Werten mehr enthält.</li><li>Speicher Sie diesen unter dem Namen <code>Library_Usage_Clean.csv</code> ab.</li><li>Wie viele Beobachtungen wurden dabei entfernt?</li></ul></div></div><footer class=footline></footer></div></div><div id=navigation><a class="nav nav-prev" href=/data-librarian/basics/pandas/rows/ title="Auswahl von Zeilen"><i class="fa fa-chevron-left"></i></a><a class="nav nav-next" href=/data-librarian/basics/pandas/functions/ title="Nützliche Funktionen in Pandas" style=margin-right:0><i class="fa fa-chevron-right"></i></a></div></section><div style=left:-1000px;overflow:scroll;position:absolute;top:-1000px;border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px><div style=border:none;box-sizing:content-box;height:200px;margin:0;padding:0;width:200px></div></div><script src=/data-librarian/js/clipboard.min.js?1580061250></script><script src=/data-librarian/js/perfect-scrollbar.min.js?1580061250></script><script src=/data-librarian/js/perfect-scrollbar.jquery.min.js?1580061250></script><script src=/data-librarian/js/jquery.sticky.js?1580061250></script><script src=/data-librarian/js/featherlight.min.js?1580061250></script><script src=/data-librarian/js/highlight.pack.js?1580061250></script><script>hljs.initHighlightingOnLoad();</script><script src=/data-librarian/js/modernizr.custom-3.6.0.js?1580061250></script><script src=/data-librarian/js/learn.js?1580061250></script><script src=/data-librarian/js/hugo-learn.js?1580061250></script><link href=/data-librarian/mermaid/mermaid.css?1580061250 rel=stylesheet><script src=/data-librarian/mermaid/mermaid.js?1580061250></script><script>mermaid.initialize({startOnLoad:true});</script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script type=text/javascript async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML">MathJax.Hub.Config({tex2jax:{inlineMath:[['$','$'],['\\(','\\)']],displayMath:[['$$','$$']],processEscapes:true,processEnvironments:true,skipTags:['script','noscript','style','textarea','pre'],TeX:{equationNumbers:{autoNumber:"AMS"},extensions:["AMSmath.js","AMSsymbols.js"]}}});MathJax.Hub.Queue(function(){var all=MathJax.Hub.getAllJax(),i;for(i=0;i<all.length;i+=1){all[i].SourceElement().parentNode.className+=' has-jax';}});MathJax.Hub.Config({TeX:{equationNumbers:{autoNumber:"AMS"}}});</script></body></html>